# SQL 튜닝의 실행 계획 파헤치기

## 실습환경 구성하기
- docker로 구성
- https://github.com/7ieon/SQLtune 실습 데이터
```
docker container ps -a
docker cp /Downloads/db_data #{dockerPsId}:/home

docker 콘솔 접속 후
mysql -u root -p < data_setting.sql
```

## 실행 계획 수행

### 기본 실행 계획 수행
- 3가지 중 사용(동일 기능)
    - EXPLAIN SQL 문;
    - DESCRIBE SQL 문;
    - DESC SQL 문;
- 기본 실행 계획 항목 분석
    - id
        - 실행 순서표시(숫자가 작을수록 먼저 수행)
        - id가 같으면 두개의 테이블이 조인된 것
    - select_type
        - select 문의 유형을 출력하는 항목
        - SIMPLE: UNION이나 내부 쿼리가 없는 SELECT 문(단순 SELECT 문)
        - PRIMARY: 서브쿼리가 포함된 SQL 문이 있을 때 첫번째 SELECT 문에 해당하는 구문에 표시되는 유형(스칼라 서브쿼리, UNION ALL의 첫번째 SELECT 문)
        - SUBQUERY: 독립적으로 수행되는 서브쿼리
        - DERIVED: FROM 절에 작성된 서브쿼리
        - UNION: UNION 및 UNION ALL 구문으로 합쳐진 SELECT 문에서 첫 번째 SELECT 구문을 제외한 이후의 SELECT 구문
        - UNION RESULT: UNION ALL이 아닌 UNION 구문으로 SELECT 절을 결합햇을떄 출력
        - DEPENDENT SUBQUERY: 서브쿼리가 메인 테이블의 영향을 받는 경우(SQL 튜닝 대상)
        - DEPENDENT UNION: UNION 또는 UNION ALL을 사용하는 서브쿼리가 메인 테이블의 영향을 받는 경우로 UNION으로 연결된 단위 쿼리 중 첫 번쨰 단위 쿼리를 제외하고 두 번째 단위 쿼리에 해당하는 경우(SQL 튜닝 대상)
        - UNCACHEABLE SUBQUERY: 메모리에 상주하여 재활용되어야 할 서브쿼리가 재사용되지 못할 때 출력되는 유형(RAND(), UUID() 함수 등을 사용하여 매번 조회가 달라지는 경우)(SQL 튜닝 대상)
        - MATERIALIZED: IN 절 구문에 연결된 서브쿼리가 임시 테이블을 생성한 뒤 조인이나 가공 작업을 수행할 때 출력되는 유형
    - table
        - 테이블 명을 표시하는 항목, 테이블 명이나 테이블 별칭(alias) 출력
    - partitions
        - 데이이터가 저장된 논리적인 영역을 표시
    - type
        - 테이블의 데이터를 어떻게 찾을지에 관한 정보를 제공하는 항목
        - system: 테이블에 데이터가 없거나 한개만 있는 경우, 최상의 성능
        - const: 조회되는 데이터가 단 1건일 때 출력되는 유형, 성능상 매우 유리한 방식
        - eq_ref: 조인이 수행될 때 드리븐 테이블의 데이터에 접근하며 고유 인덱스 또는 기본 키로 단 1건의 데이터를 조회하는 방식, 성능상 가장 유리한 방식
        - ref: eq_ref와 유사한 방식으로 조인을 수행할 때 드리븐 테이블의 데이터 접근 범위가 2개 이상일 경우를 의미함, 데이터가 많으면 성능 저하의 원인이 될 수 있음
        - ref_or_null: ref와 유사하지만 IS NULL 구문에 대해 인덱스를 활용하도록 최적화된 방식
        - range: 테이블 내의 연속된 데이터 범위를 조회하는 유형(BETWEEN, IN 등), SQL 튜닝 검토 대상
        - fulltext: 텍스트 검색을 빠르게 처리하기 위해 전문 인덱스(full text index)를 사용하여 데이터에 접근하는 경우
        - index_merge: 결합된 인덱스들이 동시에 사용되는 유형, 특정 테이블에 생성된 두 개 이상의 인덱스가 병합되어 동시에 적용됨
        - index: 인덱스 풀 스캔을 의미함
        - ALL: 테이블을 처음부터 끝까지 읽는 테이블 풀 스캔 방식, 인덱스를 추가하거나 기존 인덱스를 변경하여 인덱스를 활용하도록 튜닝 가능
    - possible_keys
        - 옵티마이저가 SQL 문을 최적화하고자 사용할 수 있는 인덱스 목록을 출력함
    - key
        - 옵티마이저가 SQL 문을 최적화하고자 사용한 기본 키 또는 인덱스명을 의미함
    - key_len
        - 인덱스를 사용할 때는 인덱스 전체를 사용하거나 일부 인덱스만 사용하는데 이렇게 사용한 인덱스의 바이트수를 의미함